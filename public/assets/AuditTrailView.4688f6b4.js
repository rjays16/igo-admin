import{A as N}from"./AdminLayout.90f99d13.js";import{e as B,u as R,k as D,m as C,_ as O,f as o,o as p,c as Y,w as n,b as a,a as u,D as K,C as E,v as G,r as j,n as f,g as s,y as d,F as M,z as q,B as A,G as F,x as P,H as y,t as L,p as H,q as J}from"./index.31264443.js";import{F as Q,a as W}from"./FormOutlined.2800fa0e.js";import{S as X,a as Z,C as x,b as tt}from"./StepForwardFilled.377bf13b.js";const et=B({components:{DownOutlined:R},data(){return{loading:!0,filter_user_id:null,filter_from_date:null,filter_to_date:null,options_size:parseInt("5000")}},methods:{getUsers(){this.loading=!0;let t={per_page:this.options_size};D.post("/user",t).then(e=>{let r=e.data;this.users=r.data,this.loading=!1,C.success(r.message)}).catch(e=>{console.error(e),C.error(e.response.data.message),this.users=[],this.loading=!1})},generateAuditTrail(){this.$parent.form.filter_user_id=this.filter_user_id,this.$parent.form.filter_from_date=this.filter_from_date,this.$parent.form.filter_to_date=this.filter_to_date,this.$parent.getAuditTrail()},exportTo(t){let e=this.$parent.form;e.export_to=t.key,D.post("/audit-trail",e,{responseType:"blob"}).then(r=>{C.success("Successfully exported data.");const v=URL.createObjectURL(new Blob([r.data])),_=document.createElement("a");_.href=v,_.setAttribute("download","audit_trail."+t.key),document.body.appendChild(_),_.click(),document.body.removeChild(_)}).catch(r=>{console.error(r),C.error(r.response.data.message)})},filterOptions(t,e){var r;return((r=e==null?void 0:e.label)!=null?r:"").toLowerCase().includes(t.toLowerCase())}},mounted(){this.getUsers()}});function at(t,e,r,v,_,V){const w=o("a-select"),c=o("a-form-item"),g=o("a-col"),$=o("a-date-picker"),S=o("a-button"),T=o("a-menu-item"),z=o("a-menu"),U=o("DownOutlined"),h=o("a-dropdown"),b=o("a-row"),I=o("a-form");return p(),Y(I,{layout:"vertical",class:"filter-generate"},{default:n(()=>[a(b,{gutter:24},{default:n(()=>[a(g,{span:4},{default:n(()=>[a(c,{label:"User"},{default:n(()=>[a(w,{placeholder:"Select user",value:t.filter_user_id,"onUpdate:value":e[0]||(e[0]=m=>t.filter_user_id=m),allowClear:"",loading:t.loading,showSearch:"",optionFilterProp:"children",options:t.users,filterOption:t.filterOptions},null,8,["value","loading","options","filterOption"])]),_:1})]),_:1}),a(g,null,{default:n(()=>[a(c,{label:"From"},{default:n(()=>[a($,{value:t.filter_from_date,"onUpdate:value":e[1]||(e[1]=m=>t.filter_from_date=m),format:"YYYY/MM/DD",valueFormat:"YYYY/MM/DD",allowClear:""},null,8,["value"])]),_:1})]),_:1}),a(g,null,{default:n(()=>[a(c,{label:"To"},{default:n(()=>[a($,{value:t.filter_to_date,"onUpdate:value":e[2]||(e[2]=m=>t.filter_to_date=m),format:"YYYY/MM/DD",valueFormat:"YYYY/MM/DD",allowClear:""},null,8,["value"])]),_:1})]),_:1}),a(g,null,{default:n(()=>[a(c,null,{default:n(()=>[a(S,{type:"primary","html-type":"submit",onClick:e[3]||(e[3]=m=>t.generateAuditTrail())},{default:n(()=>[u(" Generate ")]),_:1})]),_:1})]),_:1}),a(g,null,{default:n(()=>[a(c,null,{default:n(()=>[a(h,{class:"client-action",trigger:["click"]},{overlay:n(()=>[a(z,{onClick:t.exportTo},{default:n(()=>[a(T,{key:"xlsx"},{default:n(()=>[u(" Excel File ")]),_:1}),a(T,{key:"csv"},{default:n(()=>[u(" CSV File ")]),_:1}),a(T,{key:"pdf"},{default:n(()=>[u(" PDF File ")]),_:1})]),_:1},8,["onClick"])]),default:n(()=>[a(S,null,{default:n(()=>[u(" Export To "),a(U)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const st=O(et,[["render",at],["__scopeId","data-v-6d253b24"]]);const nt=B({components:{FormOutlined:Q,DeleteOutlined:K,FilterOutlined:W,DownOutlined:R,AuditTrailGenerateForm:st,CaretUpOutlined:E,CaretDownOutlined:G,StepBackwardFilled:X,StepForwardFilled:Z,CaretLeftFilled:x,CaretRightFilled:tt},setup(){const t=j([{title:"Activity ID",dataIndex:"id",key:"id",width:100,resizable:!0},{title:"User Id",dataIndex:"user_id",key:"user_id",width:100,resizable:!0},{title:"Pages",dataIndex:"pages",key:"pages",width:150,resizable:!0},{title:"Activity",dataIndex:"activity",key:"activity",width:300,resizable:!0},{title:"Created At",dataIndex:"created_at",key:"created_at",width:150,resizable:!0}]);return{data:[],columns:t,handleResizeColumn:(r,v)=>{v.width=r},labelCol:{span:8},wrapperCol:{span:16}}},data(){return{active_records:0,data:[],audit_trail_list:[],audit_trail_pagination:{meta:{to:1},links:{next:null}},loading:!0,current:1,pageSize:parseInt("10"),page_sizes:JSON.parse('["10", "100", "500", "1000", "3000", "5000", "10000", "20000", "50000"]'),form:{page:1,per_page:parseInt("10"),filter_id:null,filter_user_id:null,filter_pages:null,filter_activity:null,filter_created_at:null,sort_id:0,sort_user_id:0,sort_pages:0,sort_activity:0,sort_created_at:0,filter_user_id:null,filter_from_date:null,filter_to_date:null,export_to:""}}},methods:{getAuditTrail(){this.form.per_page=this.pageSize,this.getAuditTrailByParams()},getAuditTrailByParams(){this.loading=!0,this.form.export_to="",D.post("/audit-trail",this.form).then(t=>{let e=t.data;this.audit_trail_list=e.data,this.audit_trail_pagination=e,this.loading=!1,C.success(e.message)}).catch(t=>{console.error(t),this.audit_trail_list=[],this.audit_trail_pagination={meta:{total:0},links:{next:null}},this.loading=!1,C.error(t.response.data.message)})},searhAuditTrail(){this.current=1,this.form.per_page=this.pageSize,this.form.page=1,this.getAuditTrailByParams()},onPageChange(){this.form.per_page=this.pageSize,this.form.page=this.current,this.getAuditTrailByParams(),this.scrollToTop()},toFirstPage(){this.searhAuditTrail(),this.scrollToTop()},toPreviousPage(){this.current=this.current-1,this.form.page=this.current,this.getAuditTrailByParams(),this.scrollToTop()},toNextPage(){this.current=this.current+1,this.form.page=this.current,this.getAuditTrailByParams(),this.scrollToTop()},toLastPage(){this.current=this.audit_trail_pagination.meta.to,this.form.page=this.current,this.getAuditTrailByParams(),this.scrollToTop()},changeColumnSort(t){this.form[t]=this.form[t]+1,this.form[t]==3&&(this.form[t]=0),this.searhAuditTrail()},getAuditTrailStats(){D.get("/audit-trail/stats").then(t=>{this.active_records=t.data.data.active_records}).catch(t=>{console.error(t.response.data.message),this.active_records=0})},scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}},mounted(){this.getAuditTrail()}}),k=t=>(H("data-v-68d3e008"),t=t(),J(),t),lt={class:"pagination text-left"},ot={class:"d-inline-block"},it={class:"pagination-list lst-none p-0 d-inline-flex w-100"},rt=["disabled"],dt=["disabled"],ut={class:"d-inline-block mr-2"},pt=k(()=>s("p",{class:"d-inline-block mr-2"},"page",-1)),ct=["disabled"],_t={title:"Last Page",class:"ant-pagination-next mr-2 ant-pagination-disabled"},mt={key:0,class:"ant-table-column-sorters"},ft={class:"ant-table-column-title"},gt=k(()=>s("br",null,null,-1)),ht={class:"ant-table-column-sorter ant-table-column-sorter-full"},bt={key:1,class:"ant-table-column-sorters"},vt={class:"ant-table-column-title"},yt=k(()=>s("br",null,null,-1)),Ct={class:"ant-table-column-sorter ant-table-column-sorter-full"},kt={key:2,class:"ant-table-column-sorters"},wt={class:"ant-table-column-title"},Tt=k(()=>s("br",null,null,-1)),At={class:"ant-table-column-sorter ant-table-column-sorter-full"},Ft={key:3,class:"ant-table-column-sorters"},Pt={class:"ant-table-column-title"},$t=k(()=>s("br",null,null,-1)),St={class:"ant-table-column-sorter ant-table-column-sorter-full"},Dt={key:4,class:"ant-table-column-sorters"},zt={class:"ant-table-column-title"},Ut=k(()=>s("br",null,null,-1)),It={class:"ant-table-column-sorter ant-table-column-sorter-full"},Lt={key:0};function Bt(t,e,r,v,_,V){const w=o("AuditTrailGenerateForm"),c=o("StepBackwardFilled"),g=o("CaretLeftFilled"),$=o("a-input-number"),S=o("CaretRightFilled"),T=o("StepForwardFilled"),z=o("a-select-option"),U=o("a-select"),h=o("CaretUpOutlined"),b=o("CaretDownOutlined"),I=o("a-tag"),m=o("a-table");return p(),f(M,null,[a(w),s("div",lt,[s("div",ot,[s("ul",it,[s("li",{title:"First Page",class:d(["ant-pagination-prev",t.form.page==1?"ant-pagination-disabled":""])},[s("button",{class:"ant-pagination-item-link",type:"button",onClick:e[0]||(e[0]=(...i)=>t.toFirstPage&&t.toFirstPage(...i)),disabled:t.form.page==1},[a(c)],8,rt)],2),s("li",{class:d(["ant-pagination-prev",t.form.page==1?"ant-pagination-disabled":""])},[s("button",{class:"ant-pagination-item-link",type:"button",onClick:e[1]||(e[1]=(...i)=>t.toPreviousPage&&t.toPreviousPage(...i)),disabled:t.form.page==1},[a(g)],8,dt)],2),s("li",ut,[pt,a($,{class:"d-inline-block text-center page-number",value:t.current,"onUpdate:value":e[2]||(e[2]=i=>t.current=i),min:1,onChange:t.onPageChange,onPressEnter:t.onPageChange},null,8,["value","onChange","onPressEnter"])]),s("li",{class:d(["ant-pagination-next mr-2",t.audit_trail_pagination.links.next?"":"ant-pagination-disabled"])},[s("button",{class:"ant-pagination-item-link",type:"button",onClick:e[3]||(e[3]=(...i)=>t.toNextPage&&t.toNextPage(...i)),disabled:!t.audit_trail_pagination.links.next},[a(S)],8,ct)],2),s("li",_t,[s("button",{class:"ant-pagination-item-link",type:"button",onClick:e[4]||(e[4]=(...i)=>t.toLastPage&&t.toLastPage(...i)),disabled:""},[a(T)])]),a(U,{value:t.pageSize,"onUpdate:value":e[5]||(e[5]=i=>t.pageSize=i),onChange:t.onPageChange},{default:n(()=>[(p(!0),f(M,null,q(t.page_sizes,(i,l)=>(p(),Y(z,{value:i,key:l},{default:n(()=>[u(L(i+" / page"),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","onChange"])])])]),a(m,{sticky:"",columns:t.columns,"data-source":t.audit_trail_list,onResizeColumn:t.handleResizeColumn,scroll:{x:1500},"row-class-name":(i,l)=>l%2===1?"table-striped":null,pagination:!1,loading:t.loading},{headerCell:n(({column:i})=>[i.key==="id"?(p(),f("div",mt,[s("span",ft,[u("Activity ID"),gt,A(s("input",{class:"single-input",type:"text","onUpdate:modelValue":e[6]||(e[6]=l=>t.form.filter_id=l),onKeypress:e[7]||(e[7]=P(l=>t.searchAuditTrail(),["enter"]))},null,544),[[F,t.form.filter_id]])]),s("span",ht,[s("span",{class:"ant-table-column-sorter-inner",onClick:e[8]||(e[8]=l=>t.changeColumnSort("sort_id"))},[a(h,{class:d(["ant-table-column-sorter-up",t.form.sort_id==1?"active":""])},null,8,["class"]),a(b,{class:d(["ant-table-column-sorter-down",t.form.sort_id!=2?"":"active"])},null,8,["class"])])])])):y("",!0),i.key==="user_id"?(p(),f("div",bt,[s("span",vt,[u("User ID"),yt,A(s("input",{class:"single-input",type:"text","onUpdate:modelValue":e[9]||(e[9]=l=>t.form.filter_user_id=l),onKeypress:e[10]||(e[10]=P(l=>t.searchAuditTrail(),["enter"]))},null,544),[[F,t.form.filter_user_id]])]),s("span",Ct,[s("span",{class:"ant-table-column-sorter-inner",onClick:e[11]||(e[11]=l=>t.changeColumnSort("sort_user_id"))},[a(h,{class:d(["ant-table-column-sorter-up",t.form.sort_user_id==1?"active":""])},null,8,["class"]),a(b,{class:d(["ant-table-column-sorter-down",t.form.sort_id!=2?"":"active"])},null,8,["class"])])])])):y("",!0),i.key==="pages"?(p(),f("div",kt,[s("span",wt,[u("Pages"),Tt,A(s("input",{class:"single-input",type:"text","onUpdate:modelValue":e[12]||(e[12]=l=>t.form.filter_pages=l),onKeypress:e[13]||(e[13]=P(l=>t.searchAuditTrail(),["enter"]))},null,544),[[F,t.form.filter_pages]])]),s("span",At,[s("span",{class:"ant-table-column-sorter-inner",onClick:e[14]||(e[14]=l=>t.changeColumnSort("sort_pages"))},[a(h,{class:d(["ant-table-column-sorter-up",t.form.sort_pages==1?"active":""])},null,8,["class"]),a(b,{class:d(["ant-table-column-sorter-down",t.form.sort_pages!=2?"":"active"])},null,8,["class"])])])])):y("",!0),i.key==="activity"?(p(),f("div",Ft,[s("span",Pt,[u("Activity"),$t,A(s("input",{class:"single-input",type:"text","onUpdate:modelValue":e[15]||(e[15]=l=>t.form.filter_activity=l),onKeypress:e[16]||(e[16]=P(l=>t.searchAuditTrail(),["enter"]))},null,544),[[F,t.form.filter_activity]])]),s("span",St,[s("span",{class:"ant-table-column-sorter-inner",onClick:e[17]||(e[17]=l=>t.changeColumnSort("sort_activity"))},[a(h,{class:d(["ant-table-column-sorter-up",t.form.sort_activity==1?"active":""])},null,8,["class"]),a(b,{class:d(["ant-table-column-sorter-down",t.form.sort_activity!=2?"":"active"])},null,8,["class"])])])])):y("",!0),i.key==="created_at"?(p(),f("div",Dt,[s("span",zt,[u("Created At"),Ut,A(s("input",{class:"single-input",type:"text","onUpdate:modelValue":e[18]||(e[18]=l=>t.form.filter_created_at=l),onKeypress:e[19]||(e[19]=P(l=>t.searchAuditTrail(),["enter"]))},null,544),[[F,t.form.filter_created_at]])]),s("span",It,[s("span",{class:"ant-table-column-sorter-inner",onClick:e[20]||(e[20]=l=>t.changeColumnSort("sort_created_at"))},[a(h,{class:d(["ant-table-column-sorter-up",t.form.sort_created_at==1?"active":""])},null,8,["class"]),a(b,{class:d(["ant-table-column-sorter-down",t.form.sort_created_at!=2?"":"active"])},null,8,["class"])])])])):y("",!0)]),bodyCell:n(({column:i,text:l})=>[i.dataIndex==="txtype"?(p(),f("span",Lt,[a(I,{color:"#FBB125"},{default:n(()=>[u(L(l),1)]),_:2},1024)])):y("",!0)]),_:1},8,["columns","data-source","onResizeColumn","row-class-name","loading"])],64)}const Ot=O(nt,[["render",Bt],["__scopeId","data-v-68d3e008"]]);const Yt=B({components:{AdminLayout:N,ListData:Ot},data(){return{title:"Audit Trail"}}}),Vt={class:"view-container"};function Mt(t,e,r,v,_,V){const w=o("ListData"),c=o("AdminLayout");return p(),Y(c,{defaultKey:"10"},{default:n(()=>[s("h1",null,[s("span",null,L(t.title),1)]),s("div",Vt,[a(w)])]),_:1})}const Gt=O(Yt,[["render",Mt],["__scopeId","data-v-84573d8c"]]);export{Gt as default};
